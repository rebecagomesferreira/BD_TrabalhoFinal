<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Acompanhar Funcion√°rios</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .container {
            width: 95%;
            max-width: 1200px;
            margin: 10px auto;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 14px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: end;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        .filter-group label {
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        .filter-group input, .filter-group select {
            padding: 8px 12px;
            border: 1.5px solid #ddd;
            border-radius: 8px;
            font-size: 0.9em;
            min-width: 150px;
        }
        .search-box {
            flex: 1;
            min-width: 250px;
        }
        .search-box input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #3498db;
            border-radius: 25px;
            font-size: 0.9em;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.85em;
        }
        th, td {
            padding: 10px 12px;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #555;
            cursor: pointer;
        }
        th:hover {
            background: #e9ecef;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
        }
        .status-active {
            background: #e8f5e8;
            color: #2e7d32;
        }
        .status-inactive {
            background: #ffebee;
            color: #c62828;
        }
        .btn-view {
            background: #3498db;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75em;
        }
        .btn-view:hover {
            background: #2980b9;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        .salary-high {
            color: #2e7d32;
            font-weight: bold;
        }
        .salary-medium {
            color: #f57c00;
            font-weight: bold;
        }
        .salary-low {
            color: #c62828;
            font-weight: bold;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="card">
        <h1>üë• Acompanhar Funcion√°rios</h1>
        <p style="color: #666; margin-top: 5px;">Monitoramento e acompanhamento da equipe</p>
    </div>

    <div class="card">
        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-funcionarios">-</div>
                <div class="stat-label">Total de Funcion√°rios</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="funcionarios-ativos">-</div>
                <div class="stat-label">Funcion√°rios Ativos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="media-salarios">-</div>
                <div class="stat-label">M√©dia Salarial</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-cargos">-</div>
                <div class="stat-label">Cargos Diferentes</div>
            </div>
        </div>

        <div class="filters">
            <div class="search-box">
                <label>üîç Pesquisar Funcion√°rio</label>
                <input type="text" id="search" placeholder="Digite nome, cargo, email..." onkeyup="filtrarFuncionarios()">
            </div>
            <div class="filter-group">
                <label>Cargo</label>
                <select id="filterCargo" onchange="filtrarFuncionarios()">
                    <option value="">Todos os cargos</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Status</label>
                <select id="filterStatus" onchange="filtrarFuncionarios()">
                    <option value="">Todos</option>
                    <option value="ativo">Ativos</option>
                    <option value="inativo">Inativos</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Ordenar por</label>
                <select id="sortBy" onchange="ordenarFuncionarios()">
                    <option value="nome">Nome A-Z</option>
                    <option value="nome_desc">Nome Z-A</option>
                    <option value="salario">Menor Sal√°rio</option>
                    <option value="salario_desc">Maior Sal√°rio</option>
                    <option value="cargo">Cargo</option>
                </select>
            </div>
        </div>

        <div id="loading" class="loading">
            <div>‚è≥</div>
            <p>Carregando lista de funcion√°rios...</p>
        </div>

        <div id="error-message" class="error-message" style="display: none;"></div>

        <div id="empty-state" class="empty-state" style="display: none;">
            <div style="font-size: 3em;">üë•</div>
            <h3>Nenhum funcion√°rio encontrado</h3>
            <p>Tente ajustar os filtros de pesquisa</p>
        </div>

        <div id="table-container" style="display: none;">
            <table id="tbl">
                <thead>
                <tr>
                    <th onclick="ordenarPor('nome')">Nome</th>
                    <th onclick="ordenarPor('cargo')">Cargo</th>
                    <th onclick="ordenarPor('salario')">Sal√°rio</th>
                    <th>Email</th>
                    <th>Telefone</th>
                    <th>Data Nasc.</th>
                    <th>Status</th>
                    <th>A√ß√µes</th>
                </tr>
                </thead>
                <tbody id="tbl-body"></tbody>
            </table>

            <div style="margin-top: 15px; text-align: center; color: #666; font-size: 0.9em;">
                Mostrando <span id="showing-count">0</span> de <span id="total-count">0</span> funcion√°rios
            </div>
        </div>
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <button onclick="voltar()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">
            ‚¨Ö Voltar ao Menu
        </button>
    </div>
</div>

<script>
    const BASE = 'http://localhost:8080/api';
    let todosFuncionarios = [];
    let funcionariosFiltrados = [];
    let ordenacao = { campo: 'nome', direcao: 'asc' };

    function getStatus(funcionario) {
        // Simula√ß√£o - voc√™ pode adaptar conforme sua l√≥gica de neg√≥cio
        return Math.random() > 0.1 ? 'ativo' : 'inativo';
    }

    function traduzirStatus(status) {
        return status === 'ativo' ? 'Ativo' : 'Inativo';
    }

    function getSalaryClass(salario) {
        if (!salario) return 'salary-low';
        if (salario >= 5000) return 'salary-high';
        if (salario >= 2500) return 'salary-medium';
        return 'salary-low';
    }

    function formatarSalario(salario) {
        if (!salario) return 'R$ 0,00';
        return 'R$ ' + salario.toFixed(2).replace('.', ',');
    }

    async function loadFuncionarios() {
        showLoading();

        try {
            const res = await fetch(`${BASE}/funcionarios`);

            if (!res.ok) {
                throw new Error(`HTTP ${res.status}: ${await res.text()}`);
            }

            const data = await res.json();
            processarDados(data);

        } catch(e) {
            showError(`Erro ao carregar funcion√°rios: ${e.message}`);
            console.error('Erro detalhado:', e);
        }
    }

    function processarDados(data) {
        hideLoading();

        if (!Array.isArray(data)) {
            showError('Formato de dados inv√°lido retornado pela API');
            return;
        }

        todosFuncionarios = data.map(funcionario => ({
            ...funcionario,
            status: getStatus(funcionario)
        }));

        atualizarFiltroCargos();
        atualizarEstatisticas();
        filtrarFuncionarios();
    }

    function atualizarFiltroCargos() {
        const selectCargo = document.getElementById('filterCargo');
        const cargos = [...new Set(todosFuncionarios.map(f => f.cargo).filter(Boolean))].sort();

        // Manter o option "Todos os cargos" e adicionar os cargos encontrados
        selectCargo.innerHTML = '<option value="">Todos os cargos</option>';
        cargos.forEach(cargo => {
            const option = document.createElement('option');
            option.value = cargo;
            option.textContent = cargo;
            selectCargo.appendChild(option);
        });
    }

    function atualizarEstatisticas() {
        const total = todosFuncionarios.length;
        const ativos = todosFuncionarios.filter(f => f.status === 'ativo').length;
        const cargosUnicos = new Set(todosFuncionarios.map(f => f.cargo).filter(Boolean)).size;

        // Calcular m√©dia salarial
        const salarios = todosFuncionarios.map(f => f.salario || 0).filter(s => s > 0);
        const mediaSalarios = salarios.length > 0 ?
            salarios.reduce((a, b) => a + b, 0) / salarios.length : 0;

        document.getElementById('total-funcionarios').textContent = total;
        document.getElementById('funcionarios-ativos').textContent = ativos;
        document.getElementById('total-cargos').textContent = cargosUnicos;
        document.getElementById('media-salarios').textContent = formatarSalario(mediaSalarios);
    }

    function filtrarFuncionarios() {
        const searchTerm = document.getElementById('search').value.toLowerCase();
        const cargoFilter = document.getElementById('filterCargo').value;
        const statusFilter = document.getElementById('filterStatus').value;

        funcionariosFiltrados = todosFuncionarios.filter(funcionario => {
            // Filtro de pesquisa
            const matchSearch = !searchTerm ||
                (funcionario.nome && funcionario.nome.toLowerCase().includes(searchTerm)) ||
                (funcionario.cargo && funcionario.cargo.toLowerCase().includes(searchTerm)) ||
                (funcionario.email && funcionario.email.toLowerCase().includes(searchTerm));

            // Filtro de cargo
            const matchCargo = !cargoFilter || funcionario.cargo === cargoFilter;

            // Filtro de status
            const matchStatus = !statusFilter || funcionario.status === statusFilter;

            return matchSearch && matchCargo && matchStatus;
        });

        ordenarFuncionarios();
    }

    function ordenarFuncionarios() {
        const sortBy = document.getElementById('sortBy').value;

        // Mapear para o sistema de ordena√ß√£o
        switch(sortBy) {
            case 'nome': ordenacao = { campo: 'nome', direcao: 'asc' }; break;
            case 'nome_desc': ordenacao = { campo: 'nome', direcao: 'desc' }; break;
            case 'salario': ordenacao = { campo: 'salario', direcao: 'asc' }; break;
            case 'salario_desc': ordenacao = { campo: 'salario', direcao: 'desc' }; break;
            case 'cargo': ordenacao = { campo: 'cargo', direcao: 'asc' }; break;
            default: ordenacao = { campo: 'nome', direcao: 'asc' };
        }

        funcionariosFiltrados.sort((a, b) => {
            let valorA = a[ordenacao.campo] || '';
            let valorB = b[ordenacao.campo] || '';

            if (ordenacao.campo === 'salario') {
                valorA = valorA || 0;
                valorB = valorB || 0;
            }

            if (valorA < valorB) return ordenacao.direcao === 'asc' ? -1 : 1;
            if (valorA > valorB) return ordenacao.direcao === 'asc' ? 1 : -1;
            return 0;
        });

        exibirFuncionarios();
    }

    function ordenarPor(campo) {
        if (ordenacao.campo === campo) {
            ordenacao.direcao = ordenacao.direcao === 'asc' ? 'desc' : 'asc';
        } else {
            ordenacao.campo = campo;
            ordenacao.direcao = 'asc';
        }
        ordenarFuncionarios();
    }

    function exibirFuncionarios() {
        const tbody = document.getElementById('tbl-body');
        tbody.innerHTML = '';

        if (funcionariosFiltrados.length === 0) {
            hideTable();
            showEmptyState();
            return;
        }

        hideEmptyState();

        funcionariosFiltrados.forEach(funcionario => {
            const dataNascFormatada = funcionario.dataNascimento ?
                new Date(funcionario.dataNascimento).toLocaleDateString('pt-BR') : '-';

            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><strong>${funcionario.nome}</strong></td>
                <td>${funcionario.cargo || '-'}</td>
                <td class="${getSalaryClass(funcionario.salario)}">
                    ${formatarSalario(funcionario.salario)}
                </td>
                <td>${funcionario.email || '-'}</td>
                <td>${funcionario.telefone || '-'}</td>
                <td>${dataNascFormatada}</td>
                <td>
                    <span class="status-badge ${funcionario.status === 'ativo' ? 'status-active' : 'status-inactive'}">
                        ${traduzirStatus(funcionario.status)}
                    </span>
                </td>
                <td>
                    <button class="btn-view" onclick="verDetalhes(${funcionario.idFuncionario})">
                        üëÅÔ∏è Ver
                    </button>
                </td>
            `;
            tbody.appendChild(tr);
        });

        document.getElementById('showing-count').textContent = funcionariosFiltrados.length;
        document.getElementById('total-count').textContent = todosFuncionarios.length;
        showTable();
    }

    function verDetalhes(id) {
        const funcionario = todosFuncionarios.find(f => f.idFuncionario === id);
        if (funcionario) {
            const dataNascFormatada = funcionario.dataNascimento ?
                new Date(funcionario.dataNascimento).toLocaleDateString('pt-BR') : 'N√£o informada';

            const detalhes = `
Nome: ${funcionario.nome}
Cargo: ${funcionario.cargo || 'N√£o informado'}
Sal√°rio: ${formatarSalario(funcionario.salario)}
Email: ${funcionario.email || 'N√£o informado'}
Telefone: ${funcionario.telefone || 'N√£o informado'}
Data Nascimento: ${dataNascFormatada}
Endere√ßo: ${funcionario.endereco || 'N√£o informado'}
Status: ${traduzirStatus(funcionario.status)}
            `.trim();

            alert('üìã Detalhes do Funcion√°rio:\n\n' + detalhes);
        }
    }

    // Fun√ß√µes auxiliares de UI
    function showLoading() {
        document.getElementById('loading').style.display = 'block';
        hideError();
        hideTable();
        hideEmptyState();
    }

    function hideLoading() {
        document.getElementById('loading').style.display = 'none';
    }

    function showError(message) {
        document.getElementById('error-message').textContent = message;
        document.getElementById('error-message').style.display = 'block';
        hideLoading();
        hideTable();
        hideEmptyState();
    }

    function hideError() {
        document.getElementById('error-message').style.display = 'none';
    }

    function showTable() {
        document.getElementById('table-container').style.display = 'block';
    }

    function hideTable() {
        document.getElementById('table-container').style.display = 'none';
    }

    function showEmptyState() {
        document.getElementById('empty-state').style.display = 'block';
    }

    function hideEmptyState() {
        document.getElementById('empty-state').style.display = 'none';
    }

    function voltar() {
        location.href = 'menu.html';
    }

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
        loadFuncionarios();
    });
</script>
</body>
</html>