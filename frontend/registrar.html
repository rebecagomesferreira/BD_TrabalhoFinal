<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css" />
    <title>Registrar Conta</title>
</head>
<body>
<div class="container">
    <h1>Criar Conta</h1>

    <input id="usuario" placeholder="Usuário" />
    <input id="senha" type="password" placeholder="Senha" />

    <select id="grupo">
        <option value="">Selecione o tipo de conta</option>
        <option value="ADM">Administrador</option>
        <option value="GER">Gerente</option>
        <option value="OPE">Funcionário</option>
        <option value="VIS">Cliente</option>
    </select>

    <button onclick="reg()">Registrar</button>
    <div class="link"><a href="index.html">Voltar ao login</a></div>

    <script>
        async function reg() {
            const usuario = document.getElementById('usuario');
            const senha = document.getElementById('senha');
            const grupo = document.getElementById('grupo');

            const usuarioValue = usuario.value.trim();
            const senhaValue = senha.value;
            const grupoValue = grupo.value;

            if (!usuarioValue || !senhaValue || !grupoValue) {
                alert("Preencha todos os campos!");
                return;
            }

            try {
                // FORMATO CORRETO baseado no AuthController
                const payload = {
                    nomeUsuario: usuarioValue,
                    senha: senhaValue,
                    idGrupo: grupoValue  // ← AQUI ESTÁ A CORREÇÃO!
                };

                console.log("Enviando payload:", payload);

                let resposta = await fetch("http://localhost:8080/auth/registrar", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                if (resposta.ok) {
                    alert("✅ Conta criada com sucesso!");
                    location.href = "index.html";
                } else {
                    let errorText = await resposta.text();
                    alert("❌ Erro ao criar conta: " + errorText);
                }

            } catch (e) {
                alert("❌ Erro de conexão: " + e.message);
                console.error("Erro completo:", e);
            }
        }
    </script>
</div>
</body>
</html>